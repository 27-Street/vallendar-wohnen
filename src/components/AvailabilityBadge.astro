---
import type { Language } from '../i18n/translations';
import { getTranslation } from '../i18n/translations';

interface Props {
  available: boolean;
  availableFrom?: string;
  lang: Language;
  variant?: 'default' | 'hero';
}

const { available, availableFrom, lang, variant = 'default' } = Astro.props;
const t = getTranslation(lang);

const hasDate = available && availableFrom;
const locale = lang === 'de' ? 'de-DE' : 'en-US';
const formattedDate = hasDate
  ? new Intl.DateTimeFormat(locale, { day: 'numeric', month: 'long', year: 'numeric' }).format(new Date(availableFrom))
  : '';

const label = !available
  ? t.availability.occupied
  : hasDate
    ? `${t.availability.availableFrom} ${formattedDate}`
    : t.availability.available;

const colorClasses = {
  default: !available
    ? 'bg-neutral-800/80 text-neutral-100 backdrop-blur-sm'
    : hasDate
      ? 'bg-white/90 text-neutral-700 backdrop-blur-sm ring-1 ring-neutral-200'
      : 'bg-white/90 text-neutral-700 backdrop-blur-sm ring-1 ring-neutral-200',
  hero: !available
    ? 'bg-neutral-900/60 text-neutral-200 backdrop-blur-sm'
    : hasDate
      ? 'bg-white/15 text-white/90 backdrop-blur-sm ring-1 ring-white/20'
      : 'bg-white/15 text-white/90 backdrop-blur-sm ring-1 ring-white/20',
};

const dotColor = !available
  ? 'bg-neutral-400'
  : hasDate
    ? 'bg-amber-500'
    : 'bg-emerald-500';
---

<span
  class:list={[
    'inline-flex items-center gap-1.5 rounded-full font-medium tracking-wide',
    variant === 'hero' ? 'px-4 py-1.5 text-xs' : 'px-2.5 py-1 text-[11px] uppercase',
    colorClasses[variant],
  ]}
>
  <span class:list={['h-1.5 w-1.5 shrink-0 rounded-full', dotColor]}></span>
  {label}
</span>
