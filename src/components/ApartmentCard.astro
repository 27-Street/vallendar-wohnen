---
import type { CollectionEntry } from 'astro:content';
import type { Language } from '../i18n/translations';
import { getTranslation } from '../i18n/translations';
import { translatePath } from '../i18n/utils';
import AvailabilityBadge from './AvailabilityBadge.astro';

interface Props {
  apartment: CollectionEntry<'apartments'>;
  lang: Language;
}

const { apartment, lang } = Astro.props;
const t = getTranslation(lang);
const apt = apartment.data;

const detailPath = lang === 'de'
  ? translatePath(`/wohnungen/${apartment.id}`, lang)
  : translatePath(`/apartments/${apartment.id}`, lang);

const priceDisplay = lang === 'de'
  ? `${apt.pricePerMonth} €`
  : `€${apt.pricePerMonth}`;
---

<a
  href={detailPath}
  class="group flex flex-col overflow-hidden rounded-2xl bg-white shadow-sm ring-1 ring-neutral-200 transition-all hover:shadow-lg hover:ring-accent-300 focus:outline-none focus:ring-2 focus:ring-accent-500 focus:ring-offset-2"
>
  {/* Image area */}
  <div class="relative aspect-[16/9] overflow-hidden bg-gradient-to-br from-accent-100 to-accent-200">
    {apt.images && apt.images.length > 0 ? (
      <img
        src={apt.images[0]}
        alt={apt.name}
        loading="lazy"
        class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
      />
    ) : (
      <div class="absolute inset-0 flex items-center justify-center">
        <span class="text-sm font-medium text-accent-600/60">{t.apartment.photoPlaceholder}</span>
      </div>
    )}
    {/* Availability badge */}
    <div class="absolute top-3 right-3">
      <AvailabilityBadge available={apt.available} availableFrom={apt.availableFrom} lang={lang} />
    </div>
  </div>

  <div class="flex flex-1 flex-col p-5">
    <h3 class="text-lg font-bold text-neutral-900 transition-colors group-hover:text-accent-700">
      {apt.name}
    </h3>
    <p class="mt-1 text-sm text-neutral-500">{apt.tagline[lang]}</p>

    <div class="mt-4 flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-neutral-600">
      <span>{apt.size} m²</span>
      <span class="text-neutral-300">·</span>
      <span>{apt.rooms}</span>
      <span class="text-neutral-300">·</span>
      <span class="font-semibold text-accent-700">{priceDisplay} {t.apartment.perMonth}</span>
    </div>

    <div class="mt-auto pt-4">
      <span class="inline-flex items-center gap-1 text-sm font-medium text-accent-700 transition-all group-hover:gap-2">
        {t.apartment.learnMore}
        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
        </svg>
      </span>
    </div>
  </div>
</a>
