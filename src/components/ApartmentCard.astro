---
import type { CollectionEntry } from 'astro:content';
import { Icon } from 'astro-icon/components';
import type { Language } from '../i18n/translations';
import { getTranslation } from '../i18n/translations';
import { translatePath } from '../i18n/utils';
import AvailabilityBadge from './AvailabilityBadge.astro';

interface Props {
  apartment: CollectionEntry<'apartments'>;
  lang: Language;
}

const { apartment, lang } = Astro.props;
const t = getTranslation(lang);
const apt = apartment.data;
const primaryImage = apt.images.find((image) => image.isPrimary) ?? apt.images[0];
const primaryImageAlt = primaryImage?.caption?.[lang]
  ? `${apt.name} — ${primaryImage.caption[lang]}`
  : apt.name;

const detailPath = lang === 'de'
  ? translatePath(`/wohnungen/${apartment.id}`, lang)
  : translatePath(`/apartments/${apartment.id}`, lang);

const priceDisplay = lang === 'de'
  ? `${apt.pricePerMonth} €`
  : `€${apt.pricePerMonth}`;

const ctaLabel = apt.available
  ? t.apartment.cardCtaAvailable
  : t.apartment.cardCtaUnavailable;

const ctaTrust = apt.available
  ? t.apartment.cardCtaTrust
  : t.apartment.cardCtaTrustUnavailable;
---

<a
  href={detailPath}
  class="group flex cursor-pointer flex-col overflow-hidden rounded-2xl bg-white shadow-sm ring-1 ring-neutral-200 transition-all duration-200 hover:-translate-y-0.5 hover:shadow-xl hover:ring-accent-300 focus:outline-none focus:ring-2 focus:ring-accent-500 focus:ring-offset-2"
>
  {/* Image area */}
  <div class="relative aspect-[4/3] overflow-hidden bg-neutral-100">
    {primaryImage ? (
      <img
        src={primaryImage.image}
        alt={primaryImageAlt}
        loading="lazy"
        decoding="async"
        width="1600"
        height="1200"
        class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-[1.03]"
      />
    ) : (
      <div class="absolute inset-0 flex items-center justify-center bg-gradient-to-br from-neutral-100 to-neutral-200">
        <span class="text-sm font-medium text-neutral-400">{t.apartment.photoPlaceholder}</span>
      </div>
    )}
    {/* Availability badge */}
    <div class="absolute bottom-3 left-3">
      <AvailabilityBadge available={apt.available} availableFrom={apt.availableFrom} lang={lang} />
    </div>
  </div>

  <div class="flex flex-1 flex-col p-5">
    <h3 class="font-serif text-lg font-semibold text-neutral-900 transition-colors group-hover:text-accent-700">
      {apt.name}
    </h3>
    <p class="mt-1 text-sm text-neutral-500">{apt.tagline[lang]}</p>

    <div class="mt-4 flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-neutral-500">
      <span>{apt.size} m²</span>
      <span class="text-neutral-300">·</span>
      <span>{apt.rooms[lang]}</span>
      <span class="text-neutral-300">·</span>
      <span class="font-semibold text-neutral-900">{priceDisplay} {t.apartment.perMonth}</span>
    </div>

    <div class="mt-auto border-t border-neutral-100 pt-4">
      <div class="rounded-xl bg-accent-700 px-4 py-3 text-white transition-all duration-200 group-hover:bg-accent-800 group-hover:shadow-lg">
        <span class="flex items-center justify-between gap-3 text-sm font-semibold">
          {ctaLabel}
          <Icon name="lucide:arrow-right" class="h-4 w-4 shrink-0 transition-transform duration-200 group-hover:translate-x-1" />
        </span>
        <p class="mt-1 text-xs text-white/85">{ctaTrust}</p>
      </div>
    </div>
  </div>
</a>
