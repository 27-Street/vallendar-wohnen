---
import type { GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import AvailabilityBadge from '../../../components/AvailabilityBadge.astro';
import { getTranslation } from '../../../i18n/translations';
import { translatePath } from '../../../i18n/utils';

export const getStaticPaths: GetStaticPaths = async () => {
  const apartments = await getCollection('apartments');
  return apartments.map((apt) => ({
    params: { id: apt.id },
    props: { apartment: apt },
  }));
};

const lang = 'en' as const;
const t = getTranslation(lang);
const { apartment } = Astro.props;
const apt = apartment.data;
const total = apt.pricePerMonth + apt.utilitiesPerMonth;
---

<BaseLayout
  title={`${apt.name} — VallendarWohnen`}
  description={apt.description[lang]}
  lang={lang}
>
  <!-- Hero Area -->
  <section class="bg-gradient-to-br from-accent-950 via-accent-800 to-accent-950 pb-16 pt-32">
    <div class="mx-auto max-w-6xl px-4 sm:px-6">
      <a
        href={`/${lang}/#apartments`}
        class="inline-flex items-center gap-1 text-sm font-medium text-accent-200 transition-colors hover:text-white"
      >
        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
        </svg>
        {t.apartment.backToAll}
      </a>

      <div class="mt-6 flex flex-wrap items-start gap-4">
        <h1 class="text-4xl font-bold tracking-tight text-white sm:text-5xl">
          {apt.name}
        </h1>
        <div class="mt-1 sm:mt-2">
          <AvailabilityBadge available={apt.available} lang={lang} variant="hero" />
        </div>
      </div>
      <p class="mt-3 text-lg text-accent-100/80">{apt.tagline[lang]}</p>
    </div>
  </section>

  <!-- Image Gallery Placeholder -->
  <section class="bg-neutral-50 py-12">
    <div class="mx-auto max-w-6xl px-4 sm:px-6">
      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
        {[0, 1, 2, 3].map((i) => (
          <div
            class:list={[
              'flex items-center justify-center overflow-hidden rounded-xl bg-gradient-to-br',
              i === 0
                ? 'sm:col-span-2 sm:row-span-2 aspect-[4/3] from-accent-100 to-accent-200'
                : 'aspect-[4/3] from-accent-50 to-accent-100',
            ]}
          >
            <span class="text-sm font-medium text-accent-500/50">{t.apartment.photoPlaceholder}</span>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Details Section -->
  <section class="bg-white py-16 sm:py-20">
    <div class="mx-auto max-w-6xl px-4 sm:px-6">
      <div class="grid gap-10 lg:grid-cols-3">
        <!-- Left: Description & Details -->
        <div class="lg:col-span-2">
          <h2 class="text-2xl font-bold tracking-tight text-neutral-900">
            {apt.name}
          </h2>
          <p class="mt-4 text-neutral-600 leading-relaxed">
            {apt.description[lang]}
          </p>

          <div class="mt-8 grid grid-cols-2 gap-4 sm:grid-cols-4">
            <div class="rounded-xl bg-neutral-50 p-4 ring-1 ring-neutral-100">
              <p class="text-xs font-medium text-neutral-500 uppercase tracking-wider">{t.apartment.size}</p>
              <p class="mt-1 text-lg font-bold text-neutral-900">{apt.size} m²</p>
            </div>
            <div class="rounded-xl bg-neutral-50 p-4 ring-1 ring-neutral-100">
              <p class="text-xs font-medium text-neutral-500 uppercase tracking-wider">{t.apartment.rooms}</p>
              <p class="mt-1 text-lg font-bold text-neutral-900">{apt.rooms}</p>
            </div>
            <div class="rounded-xl bg-neutral-50 p-4 ring-1 ring-neutral-100">
              <p class="text-xs font-medium text-neutral-500 uppercase tracking-wider">{t.apartment.floor}</p>
              <p class="mt-1 text-lg font-bold text-neutral-900">{apt.floor}</p>
            </div>
            <div class="rounded-xl bg-neutral-50 p-4 ring-1 ring-neutral-100">
              <p class="text-xs font-medium text-neutral-500 uppercase tracking-wider">{t.apartment.maxOccupants}</p>
              <p class="mt-1 text-lg font-bold text-neutral-900">{apt.maxOccupants}</p>
            </div>
          </div>
        </div>

        <!-- Right: Pricing Card -->
        <div>
          <div class="rounded-2xl bg-neutral-50 p-6 ring-1 ring-neutral-200">
            <h3 class="text-lg font-bold text-neutral-900">{t.apartment.rentalCosts}</h3>

            <div class="mt-5 space-y-3">
              <div class="flex items-center justify-between text-sm">
                <span class="text-neutral-600">{t.apartment.rent}</span>
                <span class="font-semibold text-neutral-900">€{apt.pricePerMonth}</span>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span class="text-neutral-600">{t.apartment.utilities}</span>
                <span class="font-semibold text-neutral-900">€{apt.utilitiesPerMonth}</span>
              </div>
              <div class="border-t border-neutral-200 pt-3">
                <div class="flex items-center justify-between">
                  <span class="font-semibold text-neutral-900">{t.apartment.total}</span>
                  <span class="text-xl font-bold text-accent-700">€{total} <span class="text-sm font-normal text-neutral-500">{t.apartment.perMonth}</span></span>
                </div>
              </div>
            </div>

            <div class="mt-6">
              <div
                class:list={[
                  'flex items-center gap-2 rounded-lg px-4 py-3 text-sm font-semibold',
                  apt.available
                    ? 'bg-green-50 text-green-800 ring-1 ring-green-200'
                    : 'bg-red-50 text-red-800 ring-1 ring-red-200',
                ]}
              >
                <span
                  class:list={[
                    'h-2.5 w-2.5 rounded-full',
                    apt.available ? 'bg-green-500' : 'bg-red-500',
                  ]}
                ></span>
                {apt.available ? t.availability.available : t.availability.occupied}
                {apt.available && apt.availableFrom && (
                  <span class="ml-auto text-xs font-normal text-green-600">
                    {t.apartment.availableFrom} {new Date(apt.availableFrom).toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' })}
                  </span>
                )}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Amenities Section -->
  <section class="bg-neutral-50 py-16 sm:py-20">
    <div class="mx-auto max-w-6xl px-4 sm:px-6">
      <h2 class="text-2xl font-bold tracking-tight text-neutral-900">{t.apartment.amenities}</h2>
      <div class="mt-8 grid grid-cols-2 gap-3 sm:grid-cols-3 lg:grid-cols-4">
        {apt.amenities.map((amenity) => (
          <div class="flex items-center gap-3 rounded-xl bg-white p-4 ring-1 ring-neutral-200">
            <svg class="h-5 w-5 shrink-0 text-accent-600" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
            </svg>
            <span class="text-sm font-medium text-neutral-800">{amenity}</span>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Booking Inquiry CTA -->
  <section class="bg-gradient-to-br from-accent-950 via-accent-800 to-accent-950 py-16 sm:py-20">
    <div class="mx-auto max-w-3xl px-4 text-center sm:px-6">
      <h2 class="text-3xl font-bold tracking-tight text-white sm:text-4xl">
        {t.apartment.inquiry}
      </h2>
      <p class="mx-auto mt-4 max-w-xl text-accent-100/80">
        {t.apartment.inquiryText}
      </p>
      <a
        href={translatePath('/contact', lang)}
        class="mt-8 inline-flex items-center gap-2 rounded-lg bg-white px-8 py-3.5 text-sm font-semibold text-accent-900 shadow-lg transition-all hover:bg-accent-50 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-white/50 focus:ring-offset-2 focus:ring-offset-accent-900"
      >
        {t.apartment.inquiryCta}
        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
        </svg>
      </a>
    </div>
  </section>

  <!-- Back Link -->
  <section class="bg-white py-8">
    <div class="mx-auto max-w-6xl px-4 sm:px-6">
      <a
        href={`/${lang}/#apartments`}
        class="inline-flex items-center gap-1 text-sm font-medium text-accent-700 transition-colors hover:text-accent-900"
      >
        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
        </svg>
        {t.apartment.backToAll}
      </a>
    </div>
  </section>
</BaseLayout>
