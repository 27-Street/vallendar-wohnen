---
import { getCollection, getEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import ApartmentCard from '../../components/ApartmentCard.astro';
import FAQAccordion from '../../components/FAQAccordion.astro';
import { getTranslation } from '../../i18n/translations';

const lang = 'en' as const;
const t = getTranslation(lang);

const siteUrl = Astro.site?.origin ?? 'https://example.com';
const organizationJsonLd = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "VallendarWohnen",
  "url": `${siteUrl}/en/`,
  "email": "info@vallendar-wohnen.de",
  "telephone": "+4926194000000",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "Musterstraße 1",
    "addressLocality": "Vallendar",
    "postalCode": "56179",
    "addressCountry": "DE"
  },
  "description": "Furnished student apartments in Vallendar, right across from WHU."
};

const allApartments = await getCollection('apartments');
const sortedApartments = allApartments.sort((a, b) => a.data.order - b.data.order);

const homePage = await getEntry('pages', 'home');
const hero = homePage.data.hero!;
const sectionSubheadline = homePage.data.sectionSubheadline!;
const features = homePage.data.features!;

const faqPage = await getEntry('pages', 'faq');
const faqItems = faqPage.data.faq ?? [];
const localizedFaq = faqItems.map((item) => ({
  question: item.question[lang],
  answer: item.answer[lang],
}));
---

<BaseLayout title="Furnished Student Apartments in Vallendar | VallendarWohnen" description="Furnished apartments for students in Vallendar, right across from WHU. From €490/month, fully equipped with Wi-Fi and fitted kitchen." lang={lang}>
  <script type="application/ld+json" set:html={JSON.stringify(organizationJsonLd)} />

  <!-- Hero Section -->
  <section class="relative flex min-h-screen items-center justify-center overflow-hidden">
    <!-- Hero background image -->
    <div class="absolute inset-0">
      <img src="/images/hero/hero-placeholder.svg" alt="" class="h-full w-full object-cover" aria-hidden="true" />
    </div>
    <!-- Overlay for text readability -->
    <div class="absolute inset-0 bg-accent-950/40"></div>
    <!-- Decorative blurred shapes -->
    <div class="absolute -top-40 -right-40 h-96 w-96 rounded-full bg-accent-400/20 blur-3xl"></div>
    <div class="absolute -bottom-40 -left-40 h-96 w-96 rounded-full bg-accent-500/15 blur-3xl"></div>

    <div class="relative z-10 mx-auto max-w-4xl px-4 text-center sm:px-6">
      <h1 class="text-4xl font-bold leading-tight tracking-tight text-white sm:text-5xl md:text-6xl lg:text-7xl">
        {hero.headline[lang]}
      </h1>
      <p class="mx-auto mt-6 max-w-2xl text-lg text-accent-100/90 sm:text-xl">
        {hero.subheadline[lang]}
      </p>
      <a
        href="#apartments"
        class="mt-10 inline-flex items-center gap-2 rounded-lg bg-white px-8 py-3.5 text-sm font-semibold text-accent-900 shadow-lg transition-all hover:bg-accent-50 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-white/50 focus:ring-offset-2 focus:ring-offset-accent-900"
      >
        {hero.cta[lang]}
        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3" />
        </svg>
      </a>
    </div>
  </section>

  <!-- Apartment Cards Section -->
  <section id="apartments" class="bg-neutral-50 py-20 sm:py-28">
    <div class="mx-auto max-w-6xl px-4 sm:px-6">
      <h2 class="text-center text-3xl font-bold tracking-tight text-neutral-900 sm:text-4xl">
        {t.sections.apartments}
      </h2>
      <p class="mx-auto mt-4 max-w-2xl text-center text-neutral-500">
        {sectionSubheadline[lang]}
      </p>

      <div class="mt-14 grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
        {sortedApartments.map((apt) => (
          <ApartmentCard apartment={apt} lang={lang} />
        ))}
      </div>
    </div>
  </section>

  <!-- Features / Highlights Section -->
  <section class="bg-white py-20 sm:py-28">
    <div class="mx-auto max-w-6xl px-4 sm:px-6">
      <h2 class="text-center text-3xl font-bold tracking-tight text-neutral-900 sm:text-4xl">
        {t.sections.features}
      </h2>

      <div class="mt-14 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {features.map((feature) => (
          <div class="flex items-center gap-4 rounded-xl bg-neutral-50 p-5 ring-1 ring-neutral-100 transition-all duration-200 hover:shadow-md hover:ring-accent-200">
            <span class="flex h-12 w-12 shrink-0 items-center justify-center rounded-lg bg-accent-100 text-2xl">
              {feature.icon}
            </span>
            <span class="text-sm font-semibold text-neutral-800">{feature.label[lang]}</span>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- FAQ Section -->
  {localizedFaq.length > 0 && (
    <section id="faq" class="bg-neutral-50 py-20 sm:py-28">
      <div class="mx-auto max-w-3xl px-4 sm:px-6">
        <h2 class="text-center text-3xl font-bold tracking-tight text-neutral-900 sm:text-4xl">
          {t.sections.faq}
        </h2>
        <div class="mt-12">
          <FAQAccordion items={localizedFaq} />
        </div>
      </div>
    </section>
  )}
</BaseLayout>
